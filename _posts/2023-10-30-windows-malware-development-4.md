---
title: "Windows Malware Development Part 4: Payload Placement Basics - .rsrc"
header:
  teaser: /assets/images/pe.png
  teaser_home_page: true
categories:
  - Malware Dev
classes: wide
tags:
  - Malware
toc: true
toc_label: Contents
---
## Objective ##

Hey guys, welcome to the fourth part of Windows Malware Development, in which we will be looking at the final part of the basics of payload placement. In this post, we will be looking at how to place our shellcode in the `.rsrc` section.

## .rsrc Section ##

If you recall from the PE file structure post, the `.rsrc` section contains any resources that our program needs to load in order to function. From a Malware development perspective however, we can use this section our advantage. Our shellcode will now be hidden in the resources section of our program, away from plain sight.

>You will need Visual Studio/Visual studio build tools, x64dbg and Metasploit (comes with a build of Kali Linux) for this exercise.
>
>For this post, I will be using the Visual Studio GUI for the purposes of simplicity, since its easier to create and add a resource using the GUI. However, it is still possible without it.

We will be changing our shellcode in this post to actually execute something, and in the process learn how to use the Metasploit Framework in order to generate shellcode.

## Creating the Shellcode and Resource File ##

### Generating Shellcode using the Metasploit Framework ###

Readers who come from a penetration testing and red teaming background would know that the Metasploit Framework offers many tools that aid with these tasks. One of those tools is `msfvenom`, which is a console tool that can be used to generate different types of payloads and shellcode.

We will be using `msfvenom` in order to generate shellcode that launches `calc.exe` (The Windows Calculator) using `CMD`.

```sh
┌──(kali㉿kali)-[~]
└─$ msfvenom msfvenom -p windows/x64/exec CMD=calc.exe > pay.ico 
```

